<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Non spatial MOBSTER simulations • TEMULATOR</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Non spatial MOBSTER simulations">
<meta property="og:description" content="TEMULATOR">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">TEMULATOR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/MOBSTER_simulations.html">Non spatial MOBSTER simulations</a>
    </li>
    <li>
      <a href="../articles/time_series.html">Time series data</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="MOBSTER_simulations_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Non spatial MOBSTER simulations</h1>
            
      
      
      <div class="hidden name"><code>MOBSTER_simulations.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">TEMULATOR</span><span class="op">)</span> <span class="co"># package containing the simulator and datasets</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://wilkelab.org/cowplot/" class="external-link">cowplot</a></span><span class="op">)</span>  
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme_get.html" class="external-link">theme_set</a></span><span class="op">(</span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/theme_cowplot.html" class="external-link">theme_cowplot</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">gridExtra</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">grid</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></code></pre></div>
<div class="section level3">
<h3 id="labels">Labels<a class="anchor" aria-label="anchor" href="#labels"></a>
</h3>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cl_id_names</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>
  <span class="st">"0"</span><span class="op">=</span><span class="st">"Clonal"</span>,
  <span class="st">"1"</span><span class="op">=</span><span class="st">"Hitchhikers (Ancestor+Subclone)"</span>,
  <span class="st">"2"</span><span class="op">=</span><span class="st">"Ancestor Only (Subclonal)"</span>,
  <span class="st">"3"</span><span class="op">=</span><span class="st">"Subclone Only (Subclonal)"</span>
<span class="op">)</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="functions">Functions<a class="anchor" aria-label="anchor" href="#functions"></a>
</h3>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">generate_timeseries_data</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">d</span>, <span class="va">i</span><span class="op">)</span> <span class="op">{</span>
  
  <span class="va">clone_params</span> <span class="op">=</span>
    <span class="va">d</span><span class="op">$</span><span class="va">clone_parameters</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>mutationrate <span class="op">=</span> <span class="va">mutation_rates</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>birthrate <span class="op">=</span> <span class="va">birthrates</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>deathrate <span class="op">=</span> <span class="va">deathrates</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>start_time <span class="op">=</span> <span class="va">clone_start_times</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>father <span class="op">=</span> <span class="va">fathers</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
    <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="op">)</span>
  
  <span class="va">seed</span> <span class="op">=</span> <span class="va">d</span><span class="op">$</span><span class="va">simulation_parameters</span><span class="op">[</span><span class="st">"seed"</span><span class="op">]</span>
  <span class="va">tend</span> <span class="op">=</span> <span class="va">d</span><span class="op">$</span><span class="va">simulation_parameters</span><span class="op">[</span><span class="st">"simulation_end_time"</span><span class="op">]</span>
  
  <span class="co"># init simulation and record at differnent time points</span>
  <span class="va">sim</span> <span class="op">=</span> <span class="fu">new</span><span class="op">(</span><span class="va">TEMULATOR_object</span>, <span class="va">clone_params</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="va">seed</span><span class="op">)</span> <span class="co"># construct temulator object</span>
  <span class="va">n_reactions</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">1000</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fl">2</span><span class="op">^</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log2</a></span><span class="op">(</span><span class="fl">1001</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log2</a></span><span class="op">(</span><span class="va">tend</span><span class="op">)</span>, length <span class="op">=</span> <span class="fl">100</span><span class="op">)</span><span class="op">)</span>, <span class="va">tend</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
  <span class="va">pb</span> <span class="op">=</span> <span class="fu">progress</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/progress/man/progress_bar.html" class="external-link">progress_bar</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="st">"[:bar] :percent eta: :eta"</span>, <span class="va">tend</span><span class="op">)</span>
  <span class="va">all_results</span> <span class="op">=</span> <span class="cn">NULL</span>
  
  <span class="kw">for</span> <span class="op">(</span><span class="va">n</span> <span class="kw">in</span> <span class="va">n_reactions</span><span class="op">)</span> <span class="op">{</span>
    
    <span class="va">pb</span><span class="op">$</span><span class="fu">update</span><span class="op">(</span><span class="va">n</span><span class="op">/</span><span class="va">tend</span><span class="op">)</span>
    <span class="va">sim</span><span class="op">$</span><span class="va">end_time</span> <span class="op">=</span> <span class="va">n</span>   <span class="co"># 1) update the end time</span>
    <span class="va">sim</span><span class="op">$</span><span class="fu">run</span><span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span>     <span class="co"># 2) run forward, not verbose</span>
    
    <span class="va">result_this_sim</span> <span class="op">=</span>  <span class="co"># 3) Observation </span>
      <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>
        reactions <span class="op">=</span> <span class="va">sim</span><span class="op">$</span><span class="va">n_reactions</span>,
        t <span class="op">=</span> <span class="va">sim</span><span class="op">$</span><span class="va">simulation_time</span>,
        cells_a <span class="op">=</span> <span class="va">sim</span><span class="op">$</span><span class="va">cell_counts</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,
        cells_sc <span class="op">=</span> <span class="va">sim</span><span class="op">$</span><span class="va">cell_counts</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,
        cells <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">sim</span><span class="op">$</span><span class="va">cell_counts</span><span class="op">)</span>
      <span class="op">)</span>
    
    <span class="va">all_results</span> <span class="op">=</span> 
      <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span>
        <span class="va">all_results</span>,
        <span class="va">result_this_sim</span>
      <span class="op">)</span>
  <span class="op">}</span>
  
  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">all_results</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
</div>
<div class="section level1">
<h1 id="generation-of-the-simulations">Generation of the simulations<a class="anchor" aria-label="anchor" href="#generation-of-the-simulations"></a>
</h1>
<p>Below we define all the constant parameters. These are - unlike the seed, subclone birth rate <span class="math inline">\(\lambda_{sc}\)</span> and time point of mutation <span class="math inline">\(t_{sc}\)</span> - not varied. The birth rate of the ancestral clone is <span class="math inline">\(\lambda_a = 1\)</span>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Simulation parameters:</span>
<span class="va">mutation_rate</span> <span class="op">=</span> <span class="fl">16</span>   <span class="co"># mutation rate per cell doubling (m)</span>
<span class="va">death_rate</span> <span class="op">=</span> <span class="fl">0.2</span>     <span class="co"># death rate (μ)</span>
<span class="va">end_time</span> <span class="op">=</span> <span class="fl">179782830</span> <span class="co"># number of reactions until the simulation in finished</span>


<span class="co"># Sequencing parameters:</span>
<span class="va">depth_model</span> <span class="op">=</span> <span class="fl">2</span>   <span class="co"># over-dispersed beta-binomial distribution, dispersion parameter ρ=0.0</span>
<span class="va">n_clonal</span> <span class="op">=</span> <span class="fl">500</span>    <span class="co"># number of clonal mutations (N_clonal)</span>
<span class="va">depth</span> <span class="op">=</span> <span class="fl">120</span>       <span class="co"># 120x simulated coverage (C̅)</span>
<span class="va">min_vaf</span> <span class="op">=</span> <span class="fl">0.05</span>    <span class="co"># minimum VAF to accept a variant</span></code></pre></div>
<p>For each combination of <span class="math inline">\(\lambda_sc\)</span> and <span class="math inline">\(\lambda_sc\)</span> a total of <span class="math inline">\(9\)</span> simulations were generated. Since calculating these data takes significant time a dataset containing a summary of all simulation (‘mobster_summary_of_simulations’) and a list of S3 objects containing the datasets used in the paper (‘mobster_simulations’) are included in this package.</p>
<p>The first dataset summaries all <span class="math inline">\(1755\)</span> simulations:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"mobster_summary_of_simulations"</span>, package<span class="op">=</span><span class="st">"TEMULATOR"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">mobster_summary_of_simulations</span><span class="op">)</span>
<span class="co">#&gt; [1] "subclone_start"                "subclone_birthrate"           </span>
<span class="co">#&gt; [3] "n"                             "seed"                         </span>
<span class="co">#&gt; [5] "n_mutations_before_insertions" "subclone_fraction"            </span>
<span class="co">#&gt; [7] "assigned_id"</span>

<span class="va">t_sc</span> <span class="op">=</span> <span class="va">mobster_summary_of_simulations</span><span class="op">$</span><span class="va">subclone_start</span>
<span class="va">b_sc</span> <span class="op">=</span> <span class="va">mobster_summary_of_simulations</span><span class="op">$</span><span class="va">subclone_birthrate</span>

<span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"t_sc: "</span>, <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">t_sc</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span>
<span class="co">#&gt; t_sc:  4 8 16 32 64 128 256 512 1024 2048 4096 8192 16384</span>

<span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"lambda_sc: "</span>, <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">b_sc</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span>
<span class="co">#&gt; lambda_sc:  1.1 1.2 1.3 1.4 1.5 1.6 1.7 1.8 1.9 2 2.1 2.2 2.3 2.4 2.5</span>

<span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Number of rows:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">NROW</a></span><span class="op">(</span><span class="va">mobster_summary_of_simulations</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span>
<span class="co">#&gt; Number of rows: 1755</span>

<span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">t_sc</span>, <span class="va">b_sc</span><span class="op">)</span> <span class="op">==</span> <span class="fl">9</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>The second dataset contains the simulations used in the paper:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"mobster_simulations"</span>, package<span class="op">=</span><span class="st">"TEMULATOR"</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">mobster_simulations</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; 150</span>

<span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="op">(</span><span class="va">mobster_simulations</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; [ TEMULATOR result object ]</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; &gt; Clones:</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   Clone #1:</span>
<span class="co">#&gt;     - Birth rate: 1 </span>
<span class="co">#&gt;     - Death rate: 0.2 </span>
<span class="co">#&gt;     - Mutation rate: 16 </span>
<span class="co">#&gt;     =&gt; 63774069 cells (59%)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   Clone #2:</span>
<span class="co">#&gt;     - Birth rate: 1.1 </span>
<span class="co">#&gt;     - Death rate: 0.2 </span>
<span class="co">#&gt;     - Mutation rate: 16 </span>
<span class="co">#&gt;     - Start time: 16 </span>
<span class="co">#&gt;     - Accestor: Clone #0</span>
<span class="co">#&gt;     =&gt; 44089196 cells (41%)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; &gt; Other:</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  - Seed: 1521811667 </span>
<span class="co">#&gt;  -&gt; Gillespie time: NA </span>
<span class="co">#&gt;  -&gt; Total reactions: 1521811667 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; &gt; Sequencing data:</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; 1)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   # Clonal mutations: 500 </span>
<span class="co">#&gt;   # Purity: 1 </span>
<span class="co">#&gt;   # Depth: 120 </span>
<span class="co">#&gt;   # Depth model: overdispersed beta binomial </span>
<span class="co">#&gt;   # VAF cutoff: 0.05 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 961 × 5</span></span>
<span class="co">#&gt;      alt depth    vaf id    label</span>
<span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>     7   112 0.062<span style="text-decoration: underline;">5</span> 4bX0  2    </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>     6   101 0.059<span style="text-decoration: underline;">4</span> 4cX0  2    </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>     7   106 0.066<span style="text-decoration: underline;">0</span> 40X0  2    </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>     7   133 0.052<span style="text-decoration: underline;">6</span> 40X1  2    </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>     4    53 0.075<span style="text-decoration: underline;">5</span> 13X0  2    </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>    11   161 0.068<span style="text-decoration: underline;">3</span> 13X1  2    </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>     6   115 0.052<span style="text-decoration: underline;">2</span> 13X2  2    </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>     6   119 0.050<span style="text-decoration: underline;">4</span> 13X3  2    </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>     6   113 0.053<span style="text-decoration: underline;">1</span> 13X4  2    </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">10</span>     4    74 0.054<span style="text-decoration: underline;">1</span> 97X0  2    </span>
<span class="co">#&gt; <span style="color: #949494;"># … with 951 more rows</span></span>
<span class="co">#&gt; </span>
<span class="co">#&gt; -&gt; Call get_sequencing_data(x, idx=1) to retrieve these.</span></code></pre></div>
<p>These pre-calculated data are used throughout this vignette, but they could be recreated using the following code:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">NROW</a></span><span class="op">(</span><span class="va">mobster_summary_of_simulations</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span> 
  
  <span class="co"># the current variable parameters:</span>
  <span class="va">sc_st</span> <span class="op">=</span> <span class="va">mobster_summary_of_simulations</span><span class="op">$</span><span class="va">subclone_start</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>
  <span class="va">sc_br</span> <span class="op">=</span> <span class="va">mobster_summary_of_simulations</span><span class="op">$</span><span class="va">subclone_birthrate</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>
  <span class="va">seed</span> <span class="op">=</span> <span class="va">mobster_summary_of_simulations</span><span class="op">$</span><span class="va">seed</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>
    
  
  <span class="va">simulation_result</span> <span class="op">=</span> 
    <span class="fu"><a href="../reference/simulateTumour.html">simulateTumour</a></span><span class="op">(</span>
      birthrates <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.0</span>, <span class="va">sc_br</span><span class="op">)</span>,
      deathrates <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">death_rate</span>, <span class="fl">2</span><span class="op">)</span>, 
      mutation_rates <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">mutation_rate</span>, <span class="fl">2</span><span class="op">)</span>,
      clone_start_times <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">sc_st</span><span class="op">)</span>,
      fathers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>,                <span class="co"># CLONAL -&gt; SC1 -&gt; SC2, linear evolution </span>
      simulation_end_time <span class="op">=</span> <span class="va">end_time</span>, 
      seed <span class="op">=</span> <span class="va">seed</span>, 
      depth_model <span class="op">=</span> <span class="va">depth_model</span>, 
      min_vaf <span class="op">=</span> <span class="va">min_vaf</span>, 
      number_clonal_mutations <span class="op">=</span> <span class="va">n_clonal</span>,
      verbose<span class="op">=</span><span class="cn">TRUE</span>
    <span class="op">)</span>
    
  
  <span class="co"># Check that the fraction of subclone cells are equal:</span>
  <span class="va">x_sc</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu">get_clone_frequency</span><span class="op">(</span><span class="va">simulation_result</span><span class="op">)</span><span class="op">[</span><span class="st">"clone_2"</span><span class="op">]</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="va">mobster_summary_of_simulations</span><span class="op">$</span><span class="va">subclone_fraction</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="va">x_sc</span><span class="op">)</span><span class="op">)</span>
  
  
  <span class="co"># Check that the included dataset is identical:</span>
  <span class="va">id</span> <span class="op">=</span> <span class="va">mobster_summary_of_simulations</span><span class="op">$</span><span class="va">assigned_id</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>
  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span> <span class="co"># one of the 150 selected simulations</span>
    
    <span class="va">make_comparable</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">d</span><span class="op">)</span> <span class="op">{</span> 
      <span class="co"># drops two ids that can differ in the objects</span>
      <span class="fu"><a href="../reference/validate_temulator_result_object.html">validate_temulator_result_object</a></span><span class="op">(</span><span class="va">d</span><span class="op">)</span> 
      <span class="va">d</span><span class="op">$</span><span class="va">mutation_data</span><span class="op">$</span><span class="va">id</span> <span class="op">=</span> <span class="cn">NULL</span> 
      <span class="va">d</span><span class="op">$</span><span class="va">mutation_data</span><span class="op">$</span><span class="va">clone</span> <span class="op">=</span> <span class="cn">NULL</span>
      <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">d</span><span class="op">)</span>
    <span class="op">}</span>
    
    <span class="va">included_data</span> <span class="op">=</span> <span class="fu">make_comparable</span><span class="op">(</span><span class="va">mobster_simulations</span><span class="op">[[</span><span class="va">id</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
    <span class="va">calculated_data</span> <span class="op">=</span> <span class="fu">make_comparable</span><span class="op">(</span><span class="va">simulation_result</span><span class="op">)</span>
    <span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="va">included_data</span>, <span class="va">calculated_data</span><span class="op">)</span><span class="op">)</span>
  <span class="op">}</span>
  
<span class="op">}</span></code></pre></div>
</div>
<div class="section level1">
<h1 id="details-on-the-simulated-dynamics">Details on the simulated dynamics<a class="anchor" aria-label="anchor" href="#details-on-the-simulated-dynamics"></a>
</h1>
<div class="section level2">
<h2 id="example-of-a-simulated-sequencing-dataset">Example of a simulated sequencing dataset<a class="anchor" aria-label="anchor" href="#example-of-a-simulated-sequencing-dataset"></a>
</h2>
<p>Let us now look at one of these examples first. In the following plot a representative example of a simulated sequencing dataset is shown. Here the single subclone (i.e., the second clone C2) with a selective advantage of <span class="math inline">\(10\%\)</span> (i.e., <span class="math inline">\(\lambda_{sc}=1.1\)</span>) was introduced at a population size of <span class="math inline">\(t_{sc} = 16\)</span>. This was done by updating one cell of <span class="math inline">\(C1\)</span> with the new phenotype <span class="math inline">\(C2\)</span>. The number the descendants of this single subclone reached is larger that of all other cells existing at <span class="math inline">\(t_{sc} = 16\)</span>. This in turn means that the fraction of cells <span class="math inline">\(x_{C2}\)</span> with the phenotype of the subclone <span class="math inline">\(C2\)</span> compared to the fraction of cells <span class="math inline">\(x_{C1}\)</span> with the ancestral phenotype <span class="math inline">\(C1\)</span> is comparatively large (i.e., <span class="math inline">\(x_{C1}=59\%\)</span> and <span class="math inline">\(x_{C2}=41\%\)</span>).</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">mobster_simulations</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, quite <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>fill<span class="op">=</span><span class="st">"Mutation type"</span><span class="op">)</span> <span class="op">+</span>  
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_fill_brewer</a></span><span class="op">(</span>
    palette <span class="op">=</span> <span class="st">"Set1"</span>,
    limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">cl_id_names</span><span class="op">)</span>,
    breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">cl_id_names</span><span class="op">)</span>,
    labels <span class="op">=</span> <span class="va">cl_id_names</span>,
    drop <span class="op">=</span> <span class="cn">FALSE</span>
  <span class="op">)</span>
<span class="co">#&gt; Scale for 'fill' is already present. Adding another scale for 'fill', which</span>
<span class="co">#&gt; will replace the existing scale.</span>
<span class="co">#&gt; Warning: Removed 148 rows containing missing values (geom_bar).</span></code></pre></div>
<p><img src="MOBSTER_simulations_files/figure-html/example_of_vaf-1.png" width="75%"></p>
<p>Four important structures or groups of cluster are highlighted in the VAF spectrum. The first one is the clonal cluster (shown in red). These are mutations that were assumed to be present in the first cell of the ancestral clone <span class="math inline">\(C1\)</span>, meaning that these are present in virtually all cells of the tumour. Since we simulated a pure and diploid tumour, this cluster is visible at a VAF of 50%.</p>
<p>The second highlighted structure is a relatively small group of mutations (shown in blue) that are present in both, some cells of the ancestral clone and all cells of the subclone. These mutations move within the cells of the subclone to a higher frequency and are hence called ‘hitchhiker mutations’. It is worthwhile to note that these mutations are present at different true frequencies in the population. This frequency depends on when these arose during the expansion of the ancestral clone.</p>
<p>The third and four highlighted structure are mutations that are only present in the selected subclone (shown in purple) and the ancestral clone (shown in green) respectively. The both form a subclonal power-law tail on their own.</p>
</div>
<div class="section level2">
<h2 id="temporal-dynamics-of-the-clones">Temporal dynamics of the clones<a class="anchor" aria-label="anchor" href="#temporal-dynamics-of-the-clones"></a>
</h2>
<p>As already described only two clones coexist in the simulated datasets. Since the cells of the subclone have a selective advantage over the cells of the ancestral clone, these eventually reach a comparatively large size. These dynamics can be clearly seen if the cell in the tumour are tracked over time. Such time series data can be generated with the ‘generate_timeseries_data’ function defined above using the following command:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">time_series_data_example</span> <span class="op">=</span> <span class="fu">generate_timeseries_data</span><span class="op">(</span><span class="va">mobster_simulations</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<p>As this might take a while a precalculated dataset is also included in the package. This can be loaded as shown in the following.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"time_series_data_example"</span>, package<span class="op">=</span><span class="st">"TEMULATOR"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">time_series_data_example</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt;   reactions        t cells_a cells_sc cells</span>
<span class="co">#&gt; 1         1 1.605989       2       NA     2</span>
<span class="co">#&gt; 2         2 2.942172       1       NA     1</span>
<span class="co">#&gt; 3         3 5.430909       2       NA     2</span>
<span class="co">#&gt; 4         4 5.637229       3       NA     3</span>
<span class="co">#&gt; 5         5 6.210463       4       NA     4</span>
<span class="co">#&gt; 6         6 6.283427       5       NA     5</span></code></pre></div>
<p>As seen above the dataset contains various variables. These are the total number of reactions <em>reactions</em> (i.e., birth &amp; death), the Gillespie time <em>t</em>, the number of cells in the population <em>cells</em>, the number of ancestral cells <em>cells_a</em>, and the number of cells of the subclone <em>cells_sc</em>. Together these data show how the number of cells for each of the two subclones change over time.</p>
<p>Let’s now look at this. The following plot shows how the absolute number (left panel) and the proportion (right panel) of the two cell types change over time.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pl</span> <span class="op">=</span> 
  <span class="va">time_series_data_example</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>n<span class="op">=</span><span class="va">cells</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu">reshape2</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/melt.html" class="external-link">melt</a></span><span class="op">(</span>id.vars<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"reactions"</span>, <span class="st">"t"</span>, <span class="st">"n"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">reactions</span>, <span class="va">t</span>, <span class="va">n</span>, clone<span class="op">=</span><span class="va">variable</span>, Absolute<span class="op">=</span><span class="va">value</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Proportion<span class="op">=</span><span class="va">Absolute</span><span class="op">/</span><span class="va">n</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu">reshape2</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/melt.html" class="external-link">melt</a></span><span class="op">(</span>id.vars<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"reactions"</span>, <span class="st">"t"</span>, <span class="st">"n"</span>, <span class="st">"clone"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">t</span>, y <span class="op">=</span> <span class="va">value</span>, color <span class="op">=</span> <span class="va">clone</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>
      linetype<span class="op">=</span><span class="st">"Subclone Introduction"</span>,
      xintercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">time_series_data_example</span>, <span class="va">t</span><span class="op">[</span><span class="va">reactions</span> <span class="op">==</span> <span class="fl">16</span><span class="op">]</span><span class="op">)</span>
    <span class="op">)</span>,
    color<span class="op">=</span><span class="st">"gray20"</span>
  <span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span>
    <span class="va">.</span><span class="op">~</span><span class="va">variable</span>, 
    scale<span class="op">=</span><span class="st">"free_y"</span>
  <span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Time"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Number of cells"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"Clone"</span>, linetype<span class="op">=</span><span class="st">""</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>
    breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"cells"</span>, <span class="st">"cells_a"</span>, <span class="st">"cells_sc"</span><span class="op">)</span>,
    labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"All cells"</span>, <span class="st">"Ancestor"</span>, <span class="st">"Subclone"</span><span class="op">)</span>,
    values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"gray10"</span>, <span class="st">"darkblue"</span>, <span class="st">"red"</span><span class="op">)</span>
  <span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_linetype_manual</a></span><span class="op">(</span>
    breaks <span class="op">=</span> <span class="st">"Subclone Introduction"</span>, 
    values <span class="op">=</span> <span class="fl">3</span>
  <span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pl</span><span class="op">)</span>
<span class="co">#&gt; Warning: Removed 15 row(s) containing missing values (geom_path).</span></code></pre></div>
<p><img src="MOBSTER_simulations_files/figure-html/plot_time_series_data-1.png" width="85%"></p>
<p>It can clearly be seen that both clones, ignoring random drift, grow exponentially over time. Since the subclone (shown in red) growths somewhat faster than the ancestral clone (shown in blue), the proportions of cell types change over time, until the subclone reaches the previously mentioned proportion of 41% at the end of the simulation. Another notable aspect is that the relative proportion of both cell types vary considerably while the population size of the subclone is small (i.e., from a time of <span class="math inline">\(t\approx 10\)</span> to <span class="math inline">\(t\approx 15\)</span>). This results from the stronger influence of random drift while the population size is small. The following plot shows a smaller window of time and allows to see these dynamics better.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pl_sc</span> <span class="op">=</span> <span class="va">pl</span> <span class="op"><a href="https://ggplot2.tidyverse.org/reference/gg-add.html" class="external-link">%+%</a></span> <span class="op">(</span><span class="va">pl</span><span class="op">$</span><span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/between.html" class="external-link">between</a></span><span class="op">(</span><span class="va">t</span>, <span class="fl">10</span>, <span class="fl">15</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pl_sc</span><span class="op">)</span></code></pre></div>
<p><img src="MOBSTER_simulations_files/figure-html/plot_time_series_data_small-1.png" width="85%"></p>
</div>
<div class="section level2">
<h2 id="relationship-between-x_sc-t_sc-and-lambda_sc">Relationship between <span class="math inline">\(x_{sc}\)</span>, <span class="math inline">\(t_{sc}\)</span> and <span class="math inline">\(\lambda_{sc}\)</span>:<a class="anchor" aria-label="anchor" href="#relationship-between-x_sc-t_sc-and-lambda_sc"></a>
</h2>
<p>In the end the resulting average proportion of cells are a function of both <span class="math inline">\(\lambda_{sc}\)</span> and <span class="math inline">\(t_{sc}\)</span>. This relationship summarised in the following plot which shows the average proportion of the subclone in all simulations.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mobster_summary_of_simulations</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">subclone_start</span>, <span class="va">subclone_birthrate</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>mean_sc_frac<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">subclone_fraction</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">subclone_start</span>, y<span class="op">=</span><span class="va">subclone_birthrate</span><span class="op">-</span><span class="fl">1</span>, fill<span class="op">=</span><span class="va">mean_sc_frac</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_tile</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_log10</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_fill_distiller</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="fl">8</span>, direction <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/bquote.html" class="external-link">bquote</a></span><span class="op">(</span><span class="va">t</span><span class="op">[</span><span class="va">sc</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/bquote.html" class="external-link">bquote</a></span><span class="op">(</span><span class="va">Delta</span><span class="op">*</span><span class="va">lambda</span><span class="op">[</span><span class="va">sc</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>fill<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/bquote.html" class="external-link">bquote</a></span><span class="op">(</span><span class="st">"Median"</span><span class="op">~</span><span class="va">N</span><span class="op">[</span><span class="va">sc</span><span class="op">]</span><span class="op">/</span><span class="va">N</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="MOBSTER_simulations_files/figure-html/sc_fracs-1.png" width="50%"></p>
<p>In the top left corner of the plot the subclones swept effectively through the population and makes up the majority of cells. In the bottom right corner the subclone did not have sufficient time (yet) to sweep to a high frequency and thus makes up only a small minority of cells. In both of these cases random sampling would rarely sample cells of the ancestral clone and sublone respectively. Likewise, subclonal mutations of the ancestral population or respectively the subclone would not show up in bulk WGS data, since they are below the limit of detection of commonly conducted sequencing experiments. In both cases the observed VAF spectrum would be ‘effectively neutral’. The fraction of simulations in which this is the case — i.e., where the ancestor or the subclone make up less than 5% of the population — are shown in the plot below.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mobster_summary_of_simulations</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">subclone_start</span>, <span class="va">subclone_birthrate</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>frac_coexist<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/between.html" class="external-link">between</a></span><span class="op">(</span><span class="va">subclone_fraction</span>, <span class="fl">0.05</span>, <span class="fl">0.95</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">subclone_start</span>, y<span class="op">=</span><span class="va">subclone_birthrate</span><span class="op">-</span><span class="fl">1</span>, fill<span class="op">=</span><span class="va">frac_coexist</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_tile</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_log10</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_fill_distiller</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="fl">8</span>, direction <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/bquote.html" class="external-link">bquote</a></span><span class="op">(</span><span class="va">t</span><span class="op">[</span><span class="va">sc</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/bquote.html" class="external-link">bquote</a></span><span class="op">(</span><span class="va">Delta</span><span class="op">*</span><span class="va">lambda</span><span class="op">[</span><span class="va">sc</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>fill<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/bquote.html" class="external-link">bquote</a></span><span class="op">(</span><span class="st">"Frac. 0.1 &lt; "</span><span class="op">*</span><span class="va">x</span><span class="op">[</span><span class="va">sc</span><span class="op">]</span><span class="op">*</span><span class="st">"&lt; 0.9"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="MOBSTER_simulations_files/figure-html/frac_detectable-1.png" width="50%"></p>
</div>
</div>
<div class="section level1">
<h1 id="selection-of-suitable-simulations">Selection of suitable simulations<a class="anchor" aria-label="anchor" href="#selection-of-suitable-simulations"></a>
</h1>
<p>The plot below shows the fraction of all cells that subclone made up. For a given insertion time the subclone can either not grow to a significant size (e.g. <span class="math inline">\(\lambda_{sc} &lt; 1.5\)</span> and <span class="math inline">\(t_{sc} = 2048\)</span>) or grow so fast that it dominates the whole population (e.g. <span class="math inline">\(\lambda_{sc} &gt; 2\)</span> and <span class="math inline">\(t_{sc} = 2048\)</span>). In neither of these two cases a subclonal cluster would be detectable in the site frequency spectrum at a medium sequencing depth of <span class="math inline">\(C \approx 120\)</span> (see figures below). Simulations where the subclone is at a very high or low frequency (red areas) are effectively neutral and from each <span class="math inline">\(20\)</span> simulations were choosen at random</p>
<p>In order to create a reasonable tests with a detactable cluster in the site frequency spectrum <span class="math inline">\(110\)</span> simulations where drawn from those where the subclone made up a fraction of <span class="math inline">\(0.2\)</span>–<span class="math inline">\(0.8\)</span> of all cells (green area in the plot blow).</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">poly_a</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="cn">Inf</span>,<span class="op">-</span><span class="cn">Inf</span>,<span class="cn">Inf</span>,<span class="cn">Inf</span>,<span class="op">-</span><span class="cn">Inf</span><span class="op">)</span>, y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.02</span>,<span class="fl">0.9</span>,<span class="fl">0.9</span>,<span class="fl">1.02</span>,<span class="fl">1.02</span><span class="op">)</span><span class="op">)</span>
<span class="va">poly_b</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="cn">Inf</span>,<span class="op">-</span><span class="cn">Inf</span>,<span class="cn">Inf</span>,<span class="cn">Inf</span>,<span class="op">-</span><span class="cn">Inf</span><span class="op">)</span>, y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.8</span>,<span class="fl">0.2</span>,<span class="fl">0.2</span>,<span class="fl">0.8</span>,<span class="fl">0.8</span><span class="op">)</span><span class="op">)</span>
<span class="va">poly_c</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="cn">Inf</span>,<span class="op">-</span><span class="cn">Inf</span>,<span class="cn">Inf</span>,<span class="cn">Inf</span>,<span class="op">-</span><span class="cn">Inf</span><span class="op">)</span>, y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.05</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0.05</span>,<span class="fl">0.05</span><span class="op">)</span><span class="op">)</span>

<span class="va">mobster_summary_of_simulations</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">subclone_start</span><span class="op">&gt;</span><span class="fl">4</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>subclone_start<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">subclone_start</span>, <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">subclone_start</span><span class="op">)</span><span class="op">)</span>, ordered<span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>subclone_birthrate_f<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">subclone_birthrate</span>, ordered<span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">subclone_birthrate</span>, y<span class="op">=</span><span class="va">subclone_fraction</span>, group<span class="op">=</span><span class="va">subclone_birthrate_f</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_polygon.html" class="external-link">geom_polygon</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">poly_a</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x</span>, y<span class="op">=</span><span class="va">y</span><span class="op">)</span>, inherit.aes <span class="op">=</span> <span class="cn">FALSE</span>, fill<span class="op">=</span><span class="st">"red"</span>, alpha<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_polygon.html" class="external-link">geom_polygon</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">poly_b</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x</span>, y<span class="op">=</span><span class="va">y</span><span class="op">)</span>, inherit.aes <span class="op">=</span> <span class="cn">FALSE</span>, fill<span class="op">=</span><span class="st">"green"</span>, alpha<span class="op">=</span><span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_polygon.html" class="external-link">geom_polygon</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">poly_c</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x</span>, y<span class="op">=</span><span class="va">y</span><span class="op">)</span>, inherit.aes <span class="op">=</span> <span class="cn">FALSE</span>, fill<span class="op">=</span><span class="st">"red"</span>, alpha<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">0.2</span>, <span class="fl">0.8</span>, <span class="fl">0.9</span><span class="op">)</span>, linetype<span class="op">=</span><span class="fl">3</span>, color<span class="op">=</span><span class="st">"gray10"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html" class="external-link">geom_boxplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>breaks<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1.5</span>,<span class="fl">2</span>,<span class="fl">2.5</span><span class="op">)</span>, labels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"1"</span>,<span class="fl">1.5</span>,<span class="fl">2</span>, <span class="fl">2.5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">subclone_start</span>, labeller <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/as_labeller.html" class="external-link">as_labeller</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"t_sc = "</span>, <span class="va">x</span><span class="op">)</span><span class="op">)</span>, ncol<span class="op">=</span><span class="fl">3</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Birthrate"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Fraction of cells subclone"</span><span class="op">)</span></code></pre></div>
<p><img src="MOBSTER_simulations_files/figure-html/fraction_subclonal_per_parameter_set-1.png" width="65%"></p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mobster_summary_of_simulations</span><span class="op">$</span><span class="va">group</span> <span class="op">=</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span><span class="va">mobster_summary_of_simulations</span><span class="op">$</span><span class="va">subclone_fraction</span> <span class="op">&lt;</span> <span class="fl">0.05</span> <span class="op">~</span> <span class="st">"neutral_low_frac"</span>, 
            <span class="va">mobster_summary_of_simulations</span><span class="op">$</span><span class="va">subclone_fraction</span> <span class="op">&gt;</span> <span class="fl">0.9</span> <span class="op">~</span> <span class="st">"neutral_high_frac"</span>,
            <span class="fu"><a href="https://dplyr.tidyverse.org/reference/between.html" class="external-link">between</a></span><span class="op">(</span><span class="va">mobster_summary_of_simulations</span><span class="op">$</span><span class="va">subclone_fraction</span>, <span class="fl">0.2</span>, <span class="fl">0.8</span><span class="op">)</span>  <span class="op">~</span> <span class="st">"detectable"</span><span class="op">)</span>


<span class="va">mobster_summary_of_simulations_subset</span> <span class="op">=</span> 
  <span class="va">mobster_summary_of_simulations</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">n_mutations_before_insertions</span> <span class="op">&gt;=</span> <span class="fl">50</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">group</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">assigned_id</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">subclone_fraction</span><span class="op">)</span>


<span class="va">ids_per_group</span> <span class="op">=</span> 
  <span class="fu"><a href="https://rdrr.io/r/base/split.html" class="external-link">split</a></span><span class="op">(</span><span class="va">mobster_summary_of_simulations_subset</span><span class="op">$</span><span class="va">assigned_id</span>,
        <span class="va">mobster_summary_of_simulations_subset</span><span class="op">$</span><span class="va">group</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">ids_per_group</span>, <span class="va">length</span><span class="op">)</span>
<span class="co">#&gt;        detectable neutral_high_frac  neutral_low_frac </span>
<span class="co">#&gt;               110                20                20</span></code></pre></div>
<div class="section level2">
<h2 id="plots-group-1-neutral-with-low-subclone-fraction">Plots group 1: Neutral with low subclone fraction<a class="anchor" aria-label="anchor" href="#plots-group-1-neutral-with-low-subclone-fraction"></a>
</h2>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">plot_grid</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">object_list</span>, <span class="va">title</span><span class="op">)</span> <span class="op">{</span>
  
  <span class="va">add_subclone_placeholder</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span>
    <span class="co"># add a fake mutation of each subclone to the data</span>
    <span class="co"># this is done to ensure that labels of them show </span>
    <span class="co"># up with the same names in the generated plots</span>
    <span class="va">place_holder</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>clone<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>, alt<span class="op">=</span><span class="fl">0</span>, depth<span class="op">=</span><span class="cn">Inf</span>, id<span class="op">=</span><span class="st">"100X0"</span><span class="op">)</span>
    <span class="va">x</span><span class="op">$</span><span class="va">mutation_data</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">mutation_data</span>, <span class="va">place_holder</span><span class="op">)</span>
    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>
  <span class="op">}</span>

  <span class="va">plots</span> <span class="op">=</span> <span class="va">object_list</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
    <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">add_subclone_placeholder</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
    <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">plot</span>, quite<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>

  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">plots</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
    
    <span class="va">plots</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span>
      <span class="va">plots</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">+</span>
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substr</a></span><span class="op">(</span><span class="va">ids_per_group</span><span class="op">[[</span><span class="va">set</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="fl">1</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>plot.caption <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0</span>, size <span class="op">=</span> <span class="fl">6</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span>
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_fill_brewer</a></span><span class="op">(</span>
        palette <span class="op">=</span> <span class="st">"Set1"</span>,
        breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">cl_id_names</span><span class="op">)</span>,
        labels <span class="op">=</span> <span class="va">cl_id_names</span>,
        drop <span class="op">=</span> <span class="cn">FALSE</span>
      <span class="op">)</span>
  <span class="op">}</span> 

  <span class="va">top</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/grid.text.html" class="external-link">textGrob</a></span><span class="op">(</span><span class="va">title</span>,  gp<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grid/gpar.html" class="external-link">gpar</a></span><span class="op">(</span>fontsize<span class="op">=</span><span class="fl">25</span>, fontface<span class="op">=</span><span class="st">"bold"</span><span class="op">)</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html" class="external-link">grid.arrange</a></span><span class="op">(</span>grobs<span class="op">=</span><span class="va">plots</span>, top<span class="op">=</span><span class="va">top</span>, ncol<span class="op">=</span><span class="fl">3</span><span class="op">)</span>
  
<span class="op">}</span></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">set</span> <span class="op">=</span> <span class="st">"neutral_low_frac"</span>
<span class="va">title</span> <span class="op">=</span> <span class="st">"Effectively neutral - Low subclone frequency"</span>
<span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html" class="external-link">plot_grid</a></span><span class="op">(</span><span class="va">mobster_simulations</span><span class="op">[</span><span class="va">ids_per_group</span><span class="op">[[</span><span class="va">set</span><span class="op">]</span><span class="op">]</span><span class="op">]</span>, <span class="va">title</span><span class="op">)</span></code></pre></div>
<p><img src="MOBSTER_simulations_files/figure-html/plot_neutral_low_frac-1.png" width="90%"></p>
</div>
<div class="section level2">
<h2 id="plots-group-2-neutral-with-high-subclone-fraction">Plots group 2: Neutral with high subclone fraction<a class="anchor" aria-label="anchor" href="#plots-group-2-neutral-with-high-subclone-fraction"></a>
</h2>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">set</span> <span class="op">=</span> <span class="st">"neutral_high_frac"</span>
<span class="va">title</span> <span class="op">=</span> <span class="st">"Effectively neutral - High subclone frequency"</span>
<span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html" class="external-link">plot_grid</a></span><span class="op">(</span><span class="va">mobster_simulations</span><span class="op">[</span><span class="va">ids_per_group</span><span class="op">[[</span><span class="va">set</span><span class="op">]</span><span class="op">]</span><span class="op">]</span>, <span class="va">title</span><span class="op">)</span></code></pre></div>
<p><img src="MOBSTER_simulations_files/figure-html/neutral_high_frac-1.png" width="90%"></p>
</div>
<div class="section level2">
<h2 id="plots-group-3-non-neutral-with-potentially-detectable-subclone">Plots group 3: Non-neutral with potentially detectable subclone<a class="anchor" aria-label="anchor" href="#plots-group-3-non-neutral-with-potentially-detectable-subclone"></a>
</h2>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">set</span> <span class="op">=</span> <span class="st">"detectable"</span>
<span class="va">title</span> <span class="op">=</span> <span class="st">"Potentially detectable subclone"</span>
<span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html" class="external-link">plot_grid</a></span><span class="op">(</span><span class="va">mobster_simulations</span><span class="op">[</span><span class="va">ids_per_group</span><span class="op">[[</span><span class="va">set</span><span class="op">]</span><span class="op">]</span><span class="op">]</span>, <span class="va">title</span><span class="op">)</span></code></pre></div>
<p><img src="MOBSTER_simulations_files/figure-html/detectable-1.png" width="90%"></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Timon Heide.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.1.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
